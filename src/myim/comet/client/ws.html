<html>
<head>
    <meta charset="UTF-8">
    <title>Web sockets test</title>
    <script type="text/javascript">
        var ws;
        var seqid = 0;
        function ToggleConnectionClicked() {
            try {
                ws = new WebSocket("ws://localhost:18090/sub");//连接服务器
                //ws.binaryType = "arraybuffer";
                ws.onopen = function (event) { 
                    // login
                    Login();

                    setInterval(SendData, 3000);

                    alert("已经与服务器建立了连接rn当前连接状态：" + this.readyState); 
                };
                ws.onmessage = function (event) { 
                    console.log("接收到服务器发送的数据：rn" + event.data); 
                    //ReadData(event.data);
                };
                ws.onclose = function (event) { 
                    alert("已经与服务器断开连接rn当前连接状态：" + this.readyState); 
                    console.log('websocket 断开: ' + event.code + ' ' + event.reason + ' ' + event.wasClean)
                };
                ws.onerror = function (event) { alert("WebSocket异常！"); };
            } catch (ex) {
                alert(ex.message);
            }
        };

        function Login() {
            var proto = {
                ver: 1,
                op: 0,
                seqid: seqid++,
                body: null,
            };
            ws.send(JSON.stringify(proto));
        }
        function SendData() {
            try {
                var proto = {
                    ver: 1,
                    op: 12,
                    seqid: seqid++,
                    body: null,
                };
                ws.send(JSON.stringify(proto));
            } catch (ex) {
                alert(ex.message);
            }
        };

        function seestate() {
            alert(ws.readyState);
        }

    </script>
</head>

<body>
    <button id='ToggleConnection' type="button" onclick='ToggleConnectionClicked();'>连接服务器</button><br /><br />
    <!--
    <button id='ToggleConnection' type="button" onclick='SendData();'>发送我的名字：lijx</button><br /><br />
    -->
    <button id='ToggleConnection' type="button" onclick='seestate();'>查看状态</button><br /><br />
</body>

</html>